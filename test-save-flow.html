<!DOCTYPE html>
<html>
<head>
    <title>Teste de Salvamento</title>
    <script src="js/core/state.js"></script>
    <script src="js/utils/time-utils.js"></script>
    <script src="js/utils/schedule-builder.js"></script>
    <script src="js/utils/conflict-validator.js"></script>
    <script src="js/schedule/schedule-generator.js"></script>
</head>
<body>
    <h1>Teste de Fluxo de Salvamento</h1>
    <div id="output"></div>
    
    <script>
        const output = document.getElementById('output');
        
        function log(msg) {
            output.innerHTML += msg + '<br>';
            console.log(msg);
        }
        
        // Inicializar estado
        initState();
        
        // Criar dados de teste
        const testPlanData = {
            sleep: '23:00',
            wake: '07:00',
            mealsCount: 3,
            jobs: [{
                name: 'Trabalho',
                times: [{ start: '08:00', end: '12:00' }]
            }],
            studies: [],
            cleaning: { start: '14:00', end: '15:00' },
            exercise: { type: 'Corrida', start: '17:00', end: '18:00' }
        };
        
        log('üìã Dados de teste criados');
        log(JSON.stringify(testPlanData, null, 2));
        
        // Simular salvamento em tempPlanData
        appState.tempPlanData = testPlanData;
        saveToStorage();
        
        log('');
        log('üíæ Salvando em tempPlanData...');
        log('tempPlanData: ' + JSON.stringify(appState.tempPlanData));
        
        // Gerar cronograma
        try {
            const schedule = generateScheduleFromData(testPlanData);
            log('');
            log('‚úÖ Cronograma gerado com sucesso!');
            log('Total de atividades: ' + schedule.length);
            
            schedule.forEach((activity, index) => {
                log(`${index + 1}. ${activity.name} (${activity.startTime || 'sem hor√°rio'} - ${activity.endTime || 'sem hor√°rio'})`);
            });
            
            // Validar conflitos
            const conflicts = validateScheduleConflicts(schedule);
            log('');
            if (conflicts.length === 0) {
                log('‚úÖ Nenhum conflito detectado!');
            } else {
                log('‚ö†Ô∏è Conflitos encontrados: ' + conflicts.length);
                conflicts.forEach(c => log('  - ' + c.message));
            }
            
        } catch (error) {
            log('');
            log('‚ùå ERRO: ' + error.message);
            log('Stack: ' + error.stack);
        }
    </script>
</body>
</html>
