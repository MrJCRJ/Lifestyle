<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Debug - Verificar Dados</title>
    <style>
      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        max-width: 1200px;
        margin: 20px auto;
        padding: 20px;
        background: #f5f5f5;
      }
      h1 {
        color: #333;
        border-bottom: 3px solid #4caf50;
        padding-bottom: 10px;
      }
      .section {
        background: white;
        padding: 20px;
        margin: 20px 0;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      h2 {
        color: #4caf50;
        margin-top: 0;
      }
      pre {
        background: #f8f8f8;
        padding: 15px;
        border-radius: 4px;
        overflow-x: auto;
        border-left: 4px solid #4caf50;
      }
      .info {
        padding: 10px;
        background: #e3f2fd;
        border-left: 4px solid #2196f3;
        margin: 10px 0;
      }
      .warning {
        padding: 10px;
        background: #fff3e0;
        border-left: 4px solid #ff9800;
        margin: 10px 0;
      }
      .error {
        padding: 10px;
        background: #ffebee;
        border-left: 4px solid #f44336;
        margin: 10px 0;
      }
      .success {
        padding: 10px;
        background: #e8f5e9;
        border-left: 4px solid #4caf50;
        margin: 10px 0;
      }
      button {
        background: #4caf50;
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 16px;
        margin: 5px;
      }
      button:hover {
        background: #45a049;
      }
      .key {
        font-weight: bold;
        color: #1976d2;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
      }
      th,
      td {
        padding: 12px;
        text-align: left;
        border-bottom: 1px solid #ddd;
      }
      th {
        background-color: #4caf50;
        color: white;
      }
      tr:hover {
        background-color: #f5f5f5;
      }
    </style>
  </head>
  <body>
    <h1>üîç Debug - Verificar Dados do Lifestyle</h1>

    <div class="section">
      <h2>üìÖ Data de Hoje</h2>
      <div id="todayInfo"></div>
    </div>

    <div class="section">
      <h2>üíæ LocalStorage</h2>
      <div id="storageInfo"></div>
    </div>

    <div class="section">
      <h2>üìã Cronogramas Salvos</h2>
      <div id="schedulesInfo"></div>
    </div>

    <div class="section">
      <h2>üéØ Verifica√ß√£o de Hoje</h2>
      <div id="todayCheck"></div>
    </div>

    <div class="section">
      <h2>‚öôÔ∏è A√ß√µes</h2>
      <button onclick="reloadData()">üîÑ Recarregar Dados</button>
      <button onclick="clearAll()">üóëÔ∏è Limpar Tudo (CUIDADO!)</button>
      <button onclick="exportData()">üì• Exportar JSON</button>
    </div>

    <script>
      function checkData() {
        // Data de hoje
        const today = new Date();
        const todayKey = getDateKey(today);
        const dayName = getDayName(today);
        const formattedDate = getFormattedDate(today);

        document.getElementById("todayInfo").innerHTML = `
                <div class="info">
                    <p><strong>Data Atual:</strong> ${today.toLocaleString(
                      "pt-BR"
                    )}</p>
                    <p><strong>Date Key:</strong> <span class="key">${todayKey}</span></p>
                    <p><strong>Nome do Dia:</strong> ${dayName}</p>
                    <p><strong>Data Formatada:</strong> ${formattedDate}</p>
                </div>
            `;

        // LocalStorage
        const data = localStorage.getItem("lifestyleData");
        if (!data) {
          document.getElementById("storageInfo").innerHTML = `
                    <div class="warning">
                        <strong>‚ö†Ô∏è Nenhum dado encontrado no localStorage!</strong>
                        <p>Parece que voc√™ ainda n√£o salvou nenhum planejamento.</p>
                    </div>
                `;
          return;
        }

        const parsed = JSON.parse(data);
        const size = new Blob([data]).size;
        const sizeKB = (size / 1024).toFixed(2);

        document.getElementById("storageInfo").innerHTML = `
                <div class="success">
                    <p><strong>‚úÖ Dados encontrados!</strong></p>
                    <p><strong>Tamanho:</strong> ${sizeKB} KB</p>
                    <p><strong>√öltima Modifica√ß√£o:</strong> ${
                      parsed.lastSaved
                        ? new Date(parsed.lastSaved).toLocaleString("pt-BR")
                        : "N√£o registrado"
                    }</p>
                    <p><strong>Filtro Ativo:</strong> ${
                      parsed.activeFilter || "today"
                    }</p>
                </div>
                <details>
                    <summary><strong>Ver JSON Completo</strong></summary>
                    <pre>${JSON.stringify(parsed, null, 2)}</pre>
                </details>
            `;

        // Cronogramas
        const dailySchedules = parsed.dailySchedules || {};
        const scheduleKeys = Object.keys(dailySchedules).sort();

        if (scheduleKeys.length === 0) {
          document.getElementById("schedulesInfo").innerHTML = `
                    <div class="warning">
                        <strong>‚ö†Ô∏è Nenhum cronograma salvo!</strong>
                        <p>Use o planejador para criar seu primeiro cronograma.</p>
                    </div>
                `;
        } else {
          let tableHTML = `
                    <div class="info">
                        <p><strong>Total de Cronogramas:</strong> ${scheduleKeys.length}</p>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Data</th>
                                <th>Dia</th>
                                <th>Atividades</th>
                                <th>Planejado?</th>
                                <th>Criado Em</th>
                            </tr>
                        </thead>
                        <tbody>
                `;

          scheduleKeys.forEach((key) => {
            const schedule = dailySchedules[key];
            const activitiesCount = schedule.activities
              ? schedule.activities.length
              : 0;
            const isPlanned = schedule.isPlanned ? "Sim" : "N√£o";
            const createdAt = schedule.createdAt
              ? new Date(schedule.createdAt).toLocaleString("pt-BR")
              : "N/A";

            tableHTML += `
                        <tr>
                            <td><span class="key">${key}</span></td>
                            <td>${schedule.dayName || "N/A"}</td>
                            <td>${activitiesCount} atividades</td>
                            <td>${isPlanned}</td>
                            <td>${createdAt}</td>
                        </tr>
                    `;
          });

          tableHTML += `
                        </tbody>
                    </table>
                `;

          document.getElementById("schedulesInfo").innerHTML = tableHTML;
        }

        // Verifica√ß√£o de hoje
        const todaySchedule = dailySchedules[todayKey];
        if (todaySchedule) {
          let activitiesHTML = "<ul>";
          if (todaySchedule.activities && todaySchedule.activities.length > 0) {
            todaySchedule.activities.forEach((act) => {
              activitiesHTML += `<li>${act.icon || ""} ${act.name} (${
                act.start
              } - ${act.end})</li>`;
            });
          } else {
            activitiesHTML += "<li>Nenhuma atividade</li>";
          }
          activitiesHTML += "</ul>";

          document.getElementById("todayCheck").innerHTML = `
                    <div class="success">
                        <h3>‚úÖ Cronograma de HOJE encontrado!</h3>
                        <p><strong>Data:</strong> ${todayKey}</p>
                        <p><strong>Dia:</strong> ${todaySchedule.dayName}</p>
                        <p><strong>Total de Atividades:</strong> ${
                          todaySchedule.activities?.length || 0
                        }</p>
                        <h4>Atividades:</h4>
                        ${activitiesHTML}
                        <details>
                            <summary><strong>Ver Dados Completos</strong></summary>
                            <pre>${JSON.stringify(todaySchedule, null, 2)}</pre>
                        </details>
                    </div>
                `;
        } else {
          document.getElementById("todayCheck").innerHTML = `
                    <div class="error">
                        <h3>‚ùå Nenhum cronograma para HOJE!</h3>
                        <p><strong>Data procurada:</strong> <span class="key">${todayKey}</span></p>
                        <p>Este √© o problema! O cronograma de hoje n√£o foi salvo em <code>dailySchedules</code>.</p>
                        <p><strong>Poss√≠veis causas:</strong></p>
                        <ul>
                            <li>Voc√™ n√£o finalizou o planejamento de hoje</li>
                            <li>Houve um erro ao salvar os dados</li>
                            <li>Os dados foram salvos com uma chave diferente</li>
                        </ul>
                    </div>
                `;
        }
      }

      function getDateKey(date) {
        const year = date.getFullYear();
        const month = String(date.getMonth() + 1).padStart(2, "0");
        const day = String(date.getDate()).padStart(2, "0");
        return `${year}-${month}-${day}`;
      }

      function getDayName(date) {
        const days = [
          "Domingo",
          "Segunda",
          "Ter√ßa",
          "Quarta",
          "Quinta",
          "Sexta",
          "S√°bado",
        ];
        return days[date.getDay()];
      }

      function getFormattedDate(date) {
        const day = date.getDate();
        const month = date.toLocaleString("pt-BR", { month: "long" });
        const year = date.getFullYear();
        return `${day} de ${month} de ${year}`;
      }

      function reloadData() {
        location.reload();
      }

      function clearAll() {
        if (
          confirm("‚ö†Ô∏è ATEN√á√ÉO! Isso vai apagar TODOS os dados. Tem certeza?")
        ) {
          if (confirm("√öltima chance! Realmente deseja apagar tudo?")) {
            localStorage.removeItem("lifestyleData");
            alert("‚úÖ Dados apagados!");
            location.reload();
          }
        }
      }

      function exportData() {
        const data = localStorage.getItem("lifestyleData");
        if (!data) {
          alert("Nenhum dado para exportar!");
          return;
        }

        const blob = new Blob([data], { type: "application/json" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = `lifestyle-backup-${new Date().toISOString()}.json`;
        a.click();
        URL.revokeObjectURL(url);
      }

      // Carregar ao iniciar
      window.onload = checkData;
    </script>
  </body>
</html>
